{{ define "main" }}


<style>
/* copy button */
.copy-btn {
  cursor: pointer;
  border: none;
  background: none;
  font-size: 1em;
  color: #0077cc;
  opacity: 0;
  transition: opacity .15s ease;
  padding: 0;
  position: absolute;  
  right: 6px;          
  top: 50%;
  transform: translateY(-50%);
}
#dayzObjects tbody td:first-child {
  position: relative; 
}

#dayzObjects tbody td:first-child:hover .copy-btn {
  opacity: 1;
}

.copy-btn:hover {
  color: #005fa3;
}
/* Flash row highlight */
@keyframes flash-highlight {
  0%   { background-color: #fff6a1; }
  100% { background-color: transparent; }
}
.flash {
  animation: flash-highlight 1s ease-out;
}



  /* Make the table full width with margin */
  #dayzObjects_wrapper {
    width: 95% !important;
    margin: 20px auto;
    overflow-x: auto; /* allow horizontal scroll on small screens */
  }
  #dayzObjects {
    width: 100% !important;
  }

  /* Flex container for table controls */
  .top-bar {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
    gap: 10px;
  }

  .top-bar select,
  .top-bar input {
    margin-right: 10px;
  }

  /* Filters container */
  #filters {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    margin-bottom: 10px;
    align-items: center;
  }

  /* Adjust search input width */
  #dayzObjects_filter input {
    width: 250px;
    max-width: 100%;
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    #filters {
      flex-direction: column;
      align-items: stretch;
    }

    #filters label, #filters select {
      width: 100%;
    }

    #dayzObjects {
      font-size: 12px;
    }
  }

  @media (max-width: 480px) {
    #dayzObjects {
      font-size: 10px;
    }
  }
</style>

<div id="filters">
  <label for="filterCategory">Category:</label>
  <select id="filterCategory">
    <option value="">All</option>
  </select>

  <label for="filterConsole">Usable on Console:</label>
  <select id="filterConsole">
    <option value="">All</option>
    <option value="‚úÖ">Yes</option>
    <option value="‚ùå">No</option>
  </select>
</div>

<table id="dayzObjects" class="display nowrap" style="width:100%">
  <thead>
    <tr>
      <th>Object name</th>
      <th>In-game name</th>
      <th>Category</th>
      <th>Model Type</th>
      <th>Path</th>
      <th>Console</th>
      <th>Search Tags</th>
    </tr>
  </thead>
  <tbody>
    {{ range .Site.Data.dayz_objects }}
    <tr>
      <td data-image="{{ with .image }}{{ . }}{{ end }}">{{ .objectName }}</td>
      <td>{{ .inGameName }}</td>
      <td>{{ .category }}</td>
      <td>{{ .modelType }}</td>
      <td>{{ .path }}</td>
      <td>{{ if .usableOnConsole }}‚úÖ{{ else }}‚ùå{{ end }}</td>
      <td>{{ with .searchTags }}{{ . }}{{ end }}</td>
    </tr>
    {{ end }}
  </tbody>
</table>

<!-- DataTables CSS/JS -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.dataTables.min.css">

<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>

<script>
$(document).ready(function() {
  var table = $('#dayzObjects').DataTable({
    responsive: true,
    pageLength: 50, // default number of items per page
    lengthMenu: [ [50, 100, 200, 500], [50, 100, 200, 500] ],
    columnDefs: [
      { targets: [6], visible: true } // Search Tags column
    ],
    dom: '<"top-bar"lfr>tip',
     language: {
    search: "Search: ",  // remove the "Search:" label
    searchPlaceholder: "'large snow rock', '308 rifles'" // 
  }
    
  });

  // Move filters into top-bar
  $("#filters").insertBefore("#dayzObjects_wrapper .top-bar");

  // Populate Category filter
  var categories = [];
  table.column(2).data().each(function(value) {
    if (categories.indexOf(value) === -1 && value !== "") categories.push(value);
  });
  categories.sort();
  categories.forEach(function(cat) {
    $('#filterCategory').append('<option value="' + cat + '">' + cat + '</option>');
  });

  // Apply filters
  $('#filterCategory').on('change', function() {
    table.column(2).search(this.value).draw();
  });
  $('#filterConsole').on('change', function() {
    table.column(5).search(this.value).draw();
  });

  // Tooltip for object images
  $('#dayzObjects tbody').on('mouseenter', 'td:first-child', function (event) {
    var imgPath = $(this).attr('data-image');
    if (!imgPath || imgPath.trim() === "") return;
    var imgSrc = '/' + imgPath;
    $('body').append(
      '<div id="imgPreview" style="position:absolute; z-index:9999; border:1px solid #ccc; background:#fff; padding:5px; box-shadow:0 2px 6px rgba(0,0,0,0.2);">' +
      '<img src="' + imgSrc + '" style="max-width:400px; max-height:400px;">' +
      '</div>'
    );
    $('#imgPreview').css({ top: event.pageY + 10, left: event.pageX + 10 });
  }).on('mousemove', 'td:first-child', function (event) {
    $('#imgPreview').css({ top: event.pageY + 10, left: event.pageX + 10 });
  }).on('mouseleave', 'td:first-child', function () {
    $('#imgPreview').remove();
  });
});

 // add copy button
  function addCopyButtons() {
    $('#dayzObjects tbody tr').each(function () {
      var $firstTd = $(this).find('td:first');
      // don't add twice
      if ($firstTd.find('.copy-btn').length) return;

      // copy proper text
      var text = $firstTd.clone().children().remove().end().text().trim();
      if (!text) return;

      var $btn = $('<button type="button" class="copy-btn" title="Copy object name">üìã</button>');

      $btn.on('click', function (e) {
        e.stopPropagation(); // IMPORTANT: prevent row expand / responsive control
        navigator.clipboard.writeText(text).then(function () {
          var $row = $(e.target).closest('tr');
          $row.addClass('flash');

          // tick mark
          var $b = $(e.target);
          var prev = $b.html();
          $b.html('‚úî');

          setTimeout(function () {
            $row.removeClass('flash');
            $b.html(prev);
          }, 1000);
        }).catch(function (err) {
          console.error('Failed to copy:', err);
        });
      });

      // keeps original cell text intact
      $firstTd.append(' ').append($btn);
    });
  }

  // initial run
  addCopyButtons();
  table.on('draw', addCopyButtons);


</script>


{{ end }}

{{ define "main" }}

<div class="annoucenment-bar">
<strong></strong>‚ö†Ô∏è This tool is a work in progress with a incomplete database. More objects added every day - see progress in the <a href="https://discord.com/channels/1414751279548203008/1414751374394261534">Discord</a>.

</div>

<style>

  .annoucenment-bar 

{background-color:F2B226;
padding: 3px;
margin: 2px; }

  /* Table styling */
  #dayzObjects_wrapper {
    width: 95% !important;
    margin: 20px auto;
    overflow-x: auto;
  }
  #dayzObjects { width: 100% !important; }

  /* Top bar & filters */
  .top-bar { display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; margin-bottom: 10px; gap: 10px; }
  .top-bar select, .top-bar input { margin-right: 10px; }
  #filters { display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 10px; align-items: center; }
  #dayzObjects_filter input { width: 250px; max-width: 100%; }
  @media (max-width: 768px) { #filters { flex-direction: column; align-items: stretch; } #filters label, #filters select { width: 100%; } #dayzObjects { font-size: 12px; } }
  @media (max-width: 480px) { #dayzObjects { font-size: 10px; } }

  /* Ensure the first td is the positioning context */
#dayzObjects tbody td:first-child {
  position: relative; /* needed for absolute positioning inside */
}
/* Copy buttons positioned at top-right with background */
.copy-btn {
  position: absolute; /* float over content */
  top: 4px;           /* small offset from top */
  right: 4px;         /* small offset from right */
  cursor: pointer;
  border: none;
  background-color: #656d6d; /* dark background */
  color: #fff;              /* white icon text */
  font-size: 1em;
  opacity: 0;
  transition: opacity 0.15s ease;
  padding: 2px 4px;         /* padding around icon */
  border-radius: 3px;        /* slightly rounded corners */
}

/* Show buttons on hover */
#dayzObjects tbody td:first-child:hover .copy-btn {
  opacity: 1;
}

/* Optional: spacing between multiple buttons */
.copy-btn + .copy-btn {
  right: 40px; /* adjust spacing between buttons */
}

.copy-btn:hover {
  color: #fff; /* maintain white on hover, or change if desired */
}

  /* Flash row highlight */
  @keyframes flash-highlight { 0% { background-color: #fff6a1; } 100% { background-color: transparent; } }
  .flash { animation: flash-highlight 1s ease-out; }
</style>

<div id="filters">
  <label for="filterCategory">Category:</label>
  <select id="filterCategory"><option value="">All</option></select>
  <label for="filterConsole">Usable on Console:</label>
  <select id="filterConsole">
    <option value="">All</option>
    <option value="‚úÖ">Yes</option>
    <option value="‚ùå">No</option>
  </select>
</div>

<table id="dayzObjects" class="display nowrap" style="width:100%">
  <thead>
    <tr>
      <th>Object name</th>
      <th>In-game name</th>
      <th>Category</th>
      <th>Model Type</th>
      <th>Path</th>
      <th>Console</th>
      <th>Search Tags</th>
    </tr>
  </thead>
  <tbody>
    {{ range .Site.Data.dayz_objects }}
    <tr>
      <td 
        data-object="{{ .objectName }}" 
        data-p3d="{{ .path }}"
        data-modeltype="{{ .modelType }}"
        data-image="{{ with .image }}{{ . }}{{ end }}"
      >
        {{ .objectName }}
        <button class="copy-btn" title="Copy object name">üìã</button>
        <button class="copy-btn editor-copy-btn" title="Copy DayZ Editor JSON">üèóÔ∏è</button>
      </td>
      <td>{{ .inGameName }}</td>
      <td>{{ .category }}</td>
      <td>{{ .modelType }}</td>
      <td>{{ .path }}</td>
      <td>{{ if .usableOnConsole }}‚úÖ{{ else }}‚ùå{{ end }}</td>
      <td>{{ with .searchTags }}{{ . }}{{ end }}</td>
    </tr>
    {{ end }}
  </tbody>
</table>

<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.dataTables.min.css">
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>

<script>
$(document).ready(function() {
  var table = $('#dayzObjects').DataTable({
    responsive: true,
    pageLength: 50,
    lengthMenu: [[50,100,200,500],[50,100,200,500]],
    columnDefs: [{ targets: [6], visible: true }],
    dom: '<"top-bar"lfr>tip',
    language: { search: "Search: ", searchPlaceholder: "'large snow rock', '308 rifles'" }
  });

  $("#filters").insertBefore("#dayzObjects_wrapper .top-bar");

  // Populate Category filter
  var categories = [];
  table.column(2).data().each(function(value){ if(value && categories.indexOf(value)===-1) categories.push(value); });
  categories.sort().forEach(function(cat){ $('#filterCategory').append('<option value="'+cat+'">'+cat+'</option>'); });
  $('#filterCategory').on('change', function(){ table.column(2).search(this.value).draw(); });
  $('#filterConsole').on('change', function(){ table.column(5).search(this.value).draw(); });

  // Hover image preview
  $('#dayzObjects tbody').on('mouseenter', 'td:first-child', function(e){
    var imgPath = $(this).data('image'); if(!imgPath) return;
    $('body').append('<div id="imgPreview" style="position:absolute; z-index:9999; border:1px solid #ccc; background:#fff; padding:5px; box-shadow:0 2px 6px rgba(0,0,0,0.2);"><img src="/'+imgPath+'" style="max-width:400px; max-height:400px;"></div>');
    $('#imgPreview').css({ top: e.pageY+10, left: e.pageX+10 });
  }).on('mousemove','td:first-child',function(e){ $('#imgPreview').css({ top: e.pageY+10, left: e.pageX+10 }); })
    .on('mouseleave','td:first-child',function(){ $('#imgPreview').remove(); });

  // Copy object name
  $('#dayzObjects tbody').on('click','.copy-btn:not(.editor-copy-btn)',function(e){
    e.stopPropagation();
    var text = $(this).closest('td').data('object');
    navigator.clipboard.writeText(text);
    var $btn = $(this); $btn.text('‚úî'); setTimeout(()=>$btn.text('üìã'),1000);
  });

  // Copy DayZ Editor JSON
  $('#dayzObjects tbody').on('click','.editor-copy-btn',function(e){
    e.stopPropagation();
    var $td = $(this).closest('td');
    var objName = $td.data('object');
    var modelType = $td.data('modeltype');
    var path = $td.data('p3d');

    var typeValue = modelType === "Config"
        ? objName
        : path.replace(/\//g,"\\") + "\\" + objName; // single backslashes, no extra leading \

    var json = [{
      Type: typeValue,
      DisplayName: "",
      Position: [0,0,0],
      Orientation: [0,0,0],
      Scale: 1.0,
      AttachmentMap: {},
      Model: "",
      Flags: 30,
      m_LowBits: 0,
      m_HighBits: 0
    }];

    navigator.clipboard.writeText(JSON.stringify(json,null,4));
    var $btn = $(this); $btn.text('‚úî'); setTimeout(()=>$btn.text('üèóÔ∏è'),1000);
  });
});
</script>

{{ end }}